# File Hash and Update Manager

Набор PHP-скриптов для вычисления SHA256 хэшей локальных файлов, кэширования результатов, а также автоматической проверки и обновления локальных образов по контрольным суммам с официальных серверов.

---

## Содержание

- **index.php** — Веб-интерфейс отображения файлов, их размеров, дат и SHA256 хэшей. Хэши отображаются с префиксом `sha256:` и являются кликабельными для копирования в буфер обмена.
- **generate_all_hashes.php** — CLI-скрипт для рекурсивного обхода выбранной папки с файлами, вычисления SHA256 и кэширования хэшей в `.hash_cache`. Поддерживается автоматическая очистка устаревших кэш-файлов.
- **update_iso.php** — Скрипт для проверки локальных файлов на актуальность с помощью официальных файлов с контрольными суммами (`SHA256SUMS`, `SHA256SUM`) по указанным URL. При обнаружении обновления скачивает свежий образ с прогресс-баром.
- **crontab** — файл с примерами задач для автоматического планирования:
  - вычисление хэшей всех файлов ежечасно,
  - обновление ISO образов ежедневно в полночь.

---

## Функционал

- Высокопроизводительное вычисление SHA256 с кэшированием для экономии времени.
- Веб-интерфейс с удобной визуализацией, копированием хэшей.
- Поддержка гибкого сопоставления локальных имен с официальными именами на серверах.
- Поддержка "latest" для автоматического определения актуальной версии образа (например, для CentOS Stream).
- Удобное скачивание с отображением прогресс-бара в консоли.
- Очистка кэша хэшей для удаления неактуальных записей.
- Автоматизация с помощью cron-заданий для регулярных обновлений и вычислений.

---

## Использование

### Веб-интерфейс

Запустите `index.php` на веб-сервере, укажите папку с файлами и кэш — интерфейс отобразит данные с возможностью копирования хэшей.

### Вычисление всех хэшей

php generate_all_hashes.php

Вычисляет и кэширует SHA256 для всех файлов в папке `files`.

### Проверка и обновление локальных образов

php update_iso.php

Проверяет файлы по ссылкам, обновляет локально устаревшие с прогресс-баром.

### Автоматическое выполнение через cron

Добавьте в вашу crontab следующий пример (отрегулируйте пути под ваш сервер):

Вычисление хэшей файлов

0 * * * * php /path/to/generate_all_hashes.php > /dev/null
Обновление iso

0 0 * * * php /path/to/update_iso.php > /dev/null

Задачи:

- пересчитывают хэши всех файлов каждый час,
- проверяют и при необходимости обновляют образы один раз в сутки в полночь.

---

## Конфигурация

- В массиве `$filesToUpdate` файла `update_iso.php` укажите ваши локальные имена, папки, URL и официальные имена образов.
- В `generate_all_hashes.php` задается корневая директория `files` и директория `.hash_cache`.
- Поддержка поддиректорий и кастомных имен для каждого файла.

---

## Требования

- PHP 7.4+ с поддержкой cURL
- Доступ в интернет для скачивания контрольных сумм и образов
- Правила доступа к файлам и папкам для записи кэша и скаченных файлов

---

## Лицензия

Открытый код для личного и коммерческого использования, с указанием авторства.
